"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _qs = _interopRequireDefault(require("qs"));

var _mergeDescriptors = _interopRequireDefault(require("merge-descriptors"));

var _rmExtra = require("@frankycty/rm-extra");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _default = app => {
  (0, _mergeDescriptors.default)(app.request, {
    get query() {
      if ((0, _rmExtra.isNilOrEmpty)(this.querystring)) return {};
      var cachedQuery = getCachedQuery(this, this.querystring);
      if ((0, _rmExtra.isNilOrEmpty)(cachedQuery)) cachedQuery = _qs.default.parse(this.querystring, {
        comma: true
      });
      return cachedQuery;
    },

    set query(obj) {
      this.querystring = _qs.default.stringify(obj);
    }

  });
};

exports.default = _default;

function getCachedQuery(_ref, querystring) {
  var {
    _querycache: cache = {}
  } = _ref;
  return cache[querystring];
}