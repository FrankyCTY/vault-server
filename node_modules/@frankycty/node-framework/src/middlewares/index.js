import compose from "koa-compose";

import helmet from "koa-helmet";
import bodyParser from "koa-bodyparser";
import compress from "koa-compress";

import cors from "./cors";
import errorHandling from "./errorHandling";
import dataCache from "./dataCache";

const defaultOpts = {
  bodyParserOpts: { enableTypes: ["json"] },
  loggingOpts: {
    autoLogging: false,
  },
  helmetOpts: {},
  compressOpts: {},
  errorHandlingOpts: {},
  requestIdOpts: {
    expose: "Request-Id",
    header: "Request-Id",
  },
  dataCacheOpts: {},
};

export default () => {
  const {
    bodyParserOpts,
    helmetOpts,
    compressOpts,
    errorHandlingOpts,
    dataCacheOpts,
  } = defaultOpts;

  return compose([
    helmet(helmetOpts),
    bodyParser(bodyParserOpts),
    cors(),
    compress(compressOpts),
    dataCache(dataCacheOpts),
    errorHandling(errorHandlingOpts),
  ]);
};
